# ConfigMap 与 Grafana Pod 必须在同一命名空间，否则 sidecar watch 不到。
# Prometheus 本身可以在任意 NS，只要：
# Service 被 Grafana 能解析
# DataSource 里 URL 写对（http://kube-prometheus-stack-prometheus.monitoring.svc.cluster.local:9090）
# 即可。
# 所以通常做法：
# Grafana + sidecar + dashboard ConfigMap → 同一个 NS（例 prom）
# Prometheus → 随意（多数人也放 prom，但非强制）


apiVersion: v1
kind: ConfigMap
metadata:
  name: nginx-demo-dashboard
  namespace: prom         # 与 Grafana 同命名空间
  labels:
    grafana_dashboard: "1"       # 关键标签，sidecar 只 watch 带它
data:
  nginx-demo.json: |
    {
        "title": "NGINX Demo",
        "uid": "nginx-demo",
        "version": 1,
        "panels": [
          {
            "id": 1,
            "title": "Requests/sec",
            "type": "stat",
            "targets": [
              {
                "expr": "rate(nginx_http_requests_total[1m])"
              }
            ],
            "gridPos": { "h": 8, "w": 12, "x": 0, "y": 0 }
          }
        ]
    }
