---
- name: tb
  shell: echo hello2

- name: 添加 Longhorn Helm 仓库
  shell: |
    helm repo add hi168 https://helm.hi168.com/charts 2>/dev/null || true
    helm repo update hi168

# - name: 创建 Longhorn 命名空间
#   shell: |
#     /opt/kube/bin/kubectl create namespace longhorn-system 2>/dev/null || true
#   changed_when: false

- name: 确保 Longhorn 配置目录存在
  file:
    path: "{{ longhorn_work_dir }}"
    state: directory
    mode: '0755'

- name: 创建 values.yaml 配置文件
  template:
    src: values.yaml.j2
    dest: "{{ longhorn_work_dir }}/values.yaml"

# - name: 部署 Longhorn
#   shell: |
#     cd {{ longhorn_work_dir }}
#     helm upgrade --install longhorn hi168/longhorn \
#       --namespace longhorn-system \
#       --version {{ longhorn_version }} \
#       -f values.yaml

# - name: 等待 Longhorn Pods 就绪
#   shell: |
#     /opt/kube/bin/kubectl wait --for=condition=Ready pod -l app.kubernetes.io/instance=longhorn -n longhorn-system --timeout=300s
